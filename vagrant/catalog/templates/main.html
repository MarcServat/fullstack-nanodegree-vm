{% extends "index.html" %}
{% block content %}
{% include 'header.html' %}
<div class="row">
    <div class="col s12">
        <div class="z-depth-5 card-panel">
                <main class="list">
                    <aside class="categories">
                        <h4 class="grey-text text-darken-2">Categories</h4>
                        {% for category in categories %}
                        <ul>
                            <li>
                                <a class="create-link" href="{{url_for('listItem',
                                    category_name=category.name)}}">{{ category.name }}
                                </a>
                            </li>
                        </ul>
                        {% endfor %}        
                    </aside>
                    <hr>
                    <section class="items">
                    <h4 class="grey-text text-darken-2">Latest Items
                        {% if 'username' in login_session %}
                            <span class="add-item">
                                <a href="{{url_for('createCatalogItem')}}">Add item</a>
                            </span>
                        {% endif %}                
                    </h4>               
                        {% for item in items %}
                            {% for category in categories %}
                                {% if category.id == item.category_id %}
                                    <p>
                                        <a href="{{url_for('itemDescription',
                                            category_name=category.name,
                                            item_title=item.title)}}">{{ item.title }}</a>
                                            ({{ category.name }})
                                    </p>
                                {% endif %}
                            {% endfor %}
                        {% endfor %}
                    </section>
                </main>
        </div>
    </div>
</div>

    <div id="result"></div>
    <script>
    function signInCallback(authResult) {
    if (authResult['code']) {
        // Hide the sign-in button now that the user is authorized
        $('#signinButton').attr('style', 'display: none');
        // Send the one-time-use code to the server, if the server responds, write a 'login successful' message to the web page and then redirect back to the main restaurants page
        $.ajax({
        type: 'POST',
        url: '/gconnect?state={{STATE}}',
        processData: false,
        data: authResult['code'],
        contentType: 'application/octet-stream; charset=utf-8',
        success: function(result) {
            // Handle or verify the server response if necessary.
            if (result) {
            $('#result').html('Login Successful!</br>'+ result + '</br>Redirecting...')
            setTimeout(function() {
            window.location.href = "/";
            }, 4000);
            
        } else if (authResult['error']) {
        console.log('There was an error: ' + authResult['error']);
    } else {
            $('#result').html('Failed to make a server-side call. Check your configuration and console.');
            }
        }
        
    }); } }
    </script>
{% endblock %}